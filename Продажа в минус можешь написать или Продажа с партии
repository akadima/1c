Пока ВыборкаНоменклатура.Следующий() Цикл

Если ВыборкаНоменклатура.Количество > ВыборкаНоменклатура.КоличествоОстаток Тогда
Сообщить ("Не хватает товара");
Отказ = Истина;
КонецЕсли;

ВыборкаДетальныеЗаписи = ВыборкаНоменклатура.Выбрать();

ОсталосьСписать = ВыборкаНоменклатура.Количество;

Пока ВыборкаДетальныеЗаписи.Следующий() и ОсталосьСписать > 0 Цикл

Списать = Мин(ОсталосьСписать, ВыборкаДетальныеЗаписи.Количество);
Движения.ОстаткиНоменклатуры.Записывать = Истина;
Движение = Движения.ОстаткиНоменклатуры.Добавить();
Движение.ВидДвижения = ВидДвиженияНакопления.Расход;
Движение.Период = Дата;
Движение.Номенклатура = ВыборкаДетальныеЗаписи.Номенклатура;
Движение.Количество = Списать;
Движение.Партия = ВыборкаДетальныеЗаписи.Партия;
ОсталосьСписать = ОсталосьСписать - Списать;

КонецЦикла;


КонецЦикла;
